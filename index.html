<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Student Portfolio Generator</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
<style>
:root {
  --bg: linear-gradient(120deg,#ffeedd 0%,#ddf6ff 100%);
  --card: #fffdfe;
  --accent: #ffaf2c;
  --accent2: #28c2ff;
  --btn-bg: #ffb032;
  --btn-hover: #ea7002;
  --border: #ffeece;
  --shadow: 0 9px 28px rgba(255,184,50,0.08);
  --badge-bg: #e4ffef;
  --badge-text: #127057;
  --tag-bg: #f9e2db;
  --tag-text: #e26b00;
  --section-band: #ffc174;
}
body {
  font-family: 'Poppins', sans-serif; background: var(--bg); margin: 0;
  min-height: 100vh; display: flex; flex-direction: column; align-items: center;
  padding: 0 0 32px 0; transition: background 0.3s;
}
.theme-switch { margin: 17px 0 12px 0; width: 100%; max-width: 650px; display: flex; gap: 12px; justify-content: flex-end;}
.theme-btn { padding: 6px 17px; font-size: 15px; border-radius: 7px; cursor: pointer; border: none;}
.theme-day { background: #3f6dbd; color: #fff; }
.theme-night { background: #252343; color: #fff; }
.theme-warm { background: #ffe4b2; color: #b64d00; }
.theme-forest { background: #486b00; color: #e6f9b9; }
.theme-ocean { background: #00aaff; color: #fff; }
.theme-mint { background: #31c48d; color: #fff; }
#form-container, #profile {
  background: var(--card); color: #222034; border-radius: 18px; box-shadow: var(--shadow);
  width: 100%; max-width: 650px; margin: 0 auto 2rem auto;
  padding: 33px 28px 32px 28px; box-sizing: border-box;
  border: 2px solid var(--border); display: none;
}
  .profile-img-container {
  width: 240px !important;
  height: 240px !important;
  border-radius: 50%;
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto;
}
.profile-img-container img {
  width: 100% !important;
  height: 100% !important;
  object-fit: cover;
  border-radius: 50%;
  display: block;
}
  .profile-img-container img.pop {
  transform: scale(1.13);     
  box-shadow: 0 9px 24px #3338; 
  transition: transform 0.23s cubic-bezier(0.53,1.81,0.44,1.05), box-shadow 0.21s;
  z-index: 4;
}
.profile-img-container img {
  transition: transform 0.22s, box-shadow 0.21s;
  cursor: pointer;
}
#form-container.active { display: block; }
#profile { display: none; }
#profile.active { display: block; }
#form-container label {
  display: block; margin: 23px 0 8px 0;
  font-size: 1.08em; font-weight: 900; letter-spacing: 0.7px; color: #be6407;
}
#form-container input, #form-container textarea, #form-container select {
  width: 100%; margin-bottom: 18px; padding: 15px 14px; font-size: 1em;
  border-radius: 10px; border: 1.7px solid #ffc174; background: #fffdfa; box-sizing: border-box;
  font-family: 'Poppins', sans-serif;
}
#form-container input[type="checkbox"] { width: auto; margin-right:11px; accent-color: var(--accent);}
#form-container .checkbox-row {display: flex; flex-wrap: wrap; gap: 18px;}
#form-container .checkbox-label { font-weight:600; color: #278052; font-size: .97em;}
#form-container button[type="submit"] { margin-top: 21px; border-radius: 12px; font-size: 1.13em; }
#form-container input[type='file'] { padding: 8px 0 8px 0;}
.edit-skill{ margin-left:7px;margin-bottom:3px; font-size:13px;}
.edit-skill button{background:var(--accent2); color:#fff; border:none; border-radius:7px;padding:3px 8px;cursor:pointer;}
.skill-row {display:flex;align-items:center;margin-bottom:9px;gap:18px;}
.skill-label {font-weight:700;color:#278052;font-size:1.07em;min-width:88px;letter-spacing:.5px;}
.skill-bar-bg{background:#e2e8f0;border-radius:7px;flex:3;height:18px;overflow:hidden;position:relative;}
.skill-bar-fill{background:var(--accent);height:18px;border-radius:7px;transition:width .6s;}
.skill-bar-val{margin-left:9px;font-size:.97em;}
.add-skill-btn{background:var(--accent2);color:#fff;margin:0 0 13px 0;border:none;border-radius:7px;padding:5px 15px;cursor:pointer;}
.project-toggle{cursor:pointer;font-size:17px;color:var(--accent2);margin-bottom:10px;display:flex;align-items:center;}
.project-toggle i{margin-right:6px;font-weight:800;}
.proj-list{margin-bottom:17px;}
.proj-item{background:#f9e2db;border-radius:13px;padding:13px 12px 10px 12px;margin-bottom:13px;}
.delproj-btn{background:#f86e1c;color:#fff;border:none;border-radius:8px;padding:4px 13px;float:right;margin:0 0 7px 10px;cursor:pointer;}
.add-proj-btn{background:#28c2ff;color:#fff;margin:5px 0 0 6px;border:none;border-radius:7px;padding:8px 14px;cursor:pointer;font-weight:600;}
.section { margin-top:38px; }
.section-title { font-family:'Poppins',sans-serif; font-weight:900; font-size:20px; color:var(--accent); display:flex; align-items:center; margin-bottom:13px;}
.section-title i {margin-right:10px;font-size:22px;}
.section-band {height:8px;background:var(--section-band);border-radius:8px;margin-bottom:22px;opacity:.11;}
.badge,.tags { display: flex; flex-wrap: wrap; gap: 7px;}
.badge { background: var(--badge-bg); color: var(--badge-text); border-radius:13px; padding:8px 13px; font-weight:700; font-size:15px; margin-top:4px;}
.tag { background: linear-gradient(90deg,#ffebb3 0%,#c6f1fa 100%); border-radius: 12px; padding: 8px 17px; color: #ffa700; font-weight: 700; font-size: 16px; margin-top: 6px; cursor:pointer; box-shadow: 0 2px 7px #ffa7001d;}
.tag:hover { background: linear-gradient(90deg,#ffc2ea 0%,#bfffee 100%); color:#df1dfa;}
.profile-actions { display: flex; gap: 18px; margin-top: 36px; justify-content: center;}
button.action-edit { background-color: #28c2ff; width: auto; padding: 10px 35px; font-size: 15px; border-radius: 8px; color: #fff; font-weight: 700; border: none; box-shadow:0 1px 6px #22b6fc12;}
button.action-edit:hover { background: #099eff;}
button.action-delete { background-color: #ff7f00; width: auto; padding: 10px 35px; font-size: 15px; border-radius: 8px; color: #fff; font-weight: 700; border: none; box-shadow:0 1px 6px #ffb03233;}
button.action-delete:hover { background: #ea7002;}
.download-section { display:flex; justify-content:center; margin-top: 33px; }
.resume-download { color:#1052d9;font-weight:700;font-size:1.13em;background:none; border:2px solid #1052d9; border-radius:8px; padding:10px 28px; cursor:pointer;}
.resume-download:hover { background:#1052d9;color:#fff;}
.project-hide {display: none;}
.project-card {background:#f2faf8;border-radius:13px;padding:15px 17px 17px 17px;margin-bottom:11px;box-shadow:0 2px 15px #27805213;}
.project-title {font-size:1.08em;font-weight:900;color:#28a085;}
.project-stack {font-size:.97em;color:#ff7f00;font-weight:700;}
.project-link {font-size:.98em;color:#1a70fb;text-decoration:underline;padding-left:6px;}
.sports-high {margin:9px 0 0 0;}
.sports-high .badge {background:#ffe6f9;color:#9500a1;}
#profile hr {height:2px;background:var(--accent);border:0;margin:32px 0;opacity:.39;}
@media (max-width: 900px) {
  #form-container,#profile{max-width:99vw;padding:12px 2vw !important;}
  .header-top{flex-direction:column;gap:14px;}
  .header-info{padding-left:1px;}
  .section-band{height:5px;}
}
@media (max-width:520px){
  .section-title{font-size:15px;}
  .label{min-width:41px;}
  #profile img.profile-pic{width:46px;height:46px;}
}
body.theme-night { --bg:#252343; --card:#1e1e34; --accent:#3fabff; --accent2:#ffaf2c; --text:#f4f6fa; --section-band:#2170d7; --tag-bg:#33345c; --tag-text:#24d5fe; --badge-bg:#313655; --badge-text:#22fff9; --btn-bg:#33345c; --btn-hover:#3fabff;}
body.theme-warm { --bg:#fff7ed; --card:#fffbf6; --accent:#FF8800; --accent2:#e67100; --text:#522701; --section-band:#b64d00; --tag-bg:#ffe4b2; --tag-text:#e67100; --badge-bg:#fff7da; --badge-text:#a85d04; --btn-bg:#FF8800; --btn-hover:#e67100;}
body.theme-day {
  --bg: linear-gradient(120deg, #cce7ff 0%, #f0f9ff 100%);
  --card: #ffffff;
  --accent: #1a3d7c;
  --accent2: #6390d6;
  --text: #1a3d7c;
  --btn-bg: #3f6dbd;
  --btn-hover: #25518a;
  --border: #d3e3fa;
  --section-band: #6c8cd5;
  --tag-bg: #c1d9ff;
  --tag-text: #25518a;
  --badge-bg: #e6f0ff;
  --badge-text: #1a3d7c;
}
body.theme-forest {
  --bg: linear-gradient(135deg, #2e4600 0%, #486b00 100%);
  --card: #374d00;
  --accent: #a2c523;
  --accent2: #d9f99d;
  --text: #e6f9b9;
  --btn-bg: #8abf1f;
  --btn-hover: #639018;
  --border: #5a7d00;
  --section-band: #74a134;
  --tag-bg: #b3cc7e;
  --tag-text: #405400;
  --badge-bg: #6b842d;
  --badge-text: #daeabd;
}
body.theme-ocean {
  --bg: linear-gradient(120deg, #87cefa 0%, #1e90ff 100%);
  --card: #ecf6fe;
  --accent: #006994;
  --accent2: #30b6f6;
  --text: #00334d;
  --btn-bg: #00aaff;
  --btn-hover: #0077a3;
  --border: #b0e6ff;
  --section-band: #24a1ce;
  --tag-bg: #caecff;
  --tag-text: #006994;
  --badge-bg: #afe2fa;
  --badge-text: #006994;
}

body.theme-mint {
  --bg: linear-gradient(120deg, #bfffe2 0%, #82eefd 100%);
  --card: #eafff9;
  --accent: #1fbe84;
  --accent2: #16cce0;
  --text: #14786c;
  --btn-bg: #31c48d;
  --btn-hover: #0ba57e;
  --border: #a6ffe9;
  --section-band: #2ed8b6;
  --tag-bg: #d6fff3;
  --tag-text: #14786c;
  --badge-bg: #c7fcee;
  --badge-text: #1fbe84;
}
@media print {
  .profile-img-container {
    width: 240px !important;
    height: 240px !important;
    border-radius: 50% !important;
    overflow: hidden ! important;
  }
  .profile-img-container img {
    width: 100% !important;
    height: 100% !important;
    border-radius: 50% !important;
    object-fit: cover !important;
    display: block;
  }
}
 @media print {
  body {background:none !important;} .theme-switch, .profile-actions, .download-section {display:none !important;}
  #profile {box-shadow:none !important; border:none !important;}
}
  .pdf-hide {
  display: none !important;
  }
</style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
</head>
<body class="theme-day">
<div class="theme-switch">
  <button class="theme-btn theme-day" onclick="setTheme('theme-day')" type="button">Day</button>
  <button class="theme-btn theme-night" onclick="setTheme('theme-night')" type="button">Night</button>
  <button class="theme-btn theme-warm" onclick="setTheme('theme-warm')" type="button">Warm</button>
  <button class="theme-btn theme-forest" onclick="setTheme('theme-forest')" type="button">Forest</button>
  <button class="theme-btn theme-ocean" onclick="setTheme('theme-ocean')" type="button">Ocean</button>
  <button class="theme-btn theme-mint" onclick="setTheme('theme-mint')" type="button">Mint</button>
</div>
<div id="form-container" class="active">
  <h1 style="color:var(--accent);text-align:center;font-size:27px;font-weight:800;margin-bottom:13px;">
    Enter Your Details for Portfolio</h1>
  <form id="profile-form" autocomplete="off">
    <label for="first-name">First Name<span style="color:#d00;">*</span>:</label>
    <input type="text" id="first-name" required />
    <label for="last-name">Last Name<span style="color:#d00;">*</span>:</label>
    <input type="text" id="last-name" required />
    <label for="rollno">Roll Number (last 3 digits)<span style="color:#d00;">*</span>:</label>
    <input type="number" id="rollno" required max="999" min="0" />
    <label for="email">Email:</label>
    <input type="email" id="email" />
    <label for="summary">Summary/About (leave blank for default):</label>
    <textarea id="summary" placeholder="Write about yourself or leave blank for deafult-summary"></textarea>
    <label for="hobbies">Hobbies:</label>
    <textarea id="hobbies" placeholder="Chess, reading, coding"></textarea>
    <label>Programming Languages Known:</label>
    <div class="checkbox-row" id="languagesbox">
      <label class="checkbox-label"><input type="checkbox" value="C" />C</label>
      <label class="checkbox-label"><input type="checkbox" value="C++" />C++</label>
      <label class="checkbox-label"><input type="checkbox" value="Python" />Python</label>
      <label class="checkbox-label"><input type="checkbox" value="Java" />Java</label>
      <label class="checkbox-label"><input type="checkbox" value="JavaScript" />JavaScript</label>
      <label class="checkbox-label"><input type="checkbox" value="Kotlin" />Kotlin</label>
      <label class="checkbox-label"><input type="checkbox" value="Go" />Go</label>
      <label class="checkbox-label"><input type="checkbox" value="Rust" />Rust</label>
      <label class="checkbox-label"><input type="checkbox" value="SQL" />SQL</label>
      <label class="checkbox-label"><input type="checkbox" value="Other" />Other</label>
    </div>
    <label>Technical Areas:</label>
    <div class="checkbox-row" id="techbox">
      <label class="checkbox-label"><input type="checkbox" value="Web Development" />Web Development</label>
      <label class="checkbox-label"><input type="checkbox" value="App Development" />App Development</label>
      <label class="checkbox-label"><input type="checkbox" value="AI/ML" />AI/ML</label>
      <label class="checkbox-label"><input type="checkbox" value="Database" />Database</label>
      <label class="checkbox-label"><input type="checkbox" value="System Programming" />System Programming</label>
      <label class="checkbox-label"><input type="checkbox" value="Other" />Other</label>
    </div>
    <label>Skills & Proficiency:</label>
    <div id="skills-area"></div>
    <button type="button" class="add-skill-btn" onclick="addSkillInput()">+ Add Skill</button>
    <label class="project-toggle" onclick="toggleProjects()">
      <i id="proj-arrow">▼</i> Projects <span style="font-weight:400;font-size:.95em;margin-left:8px;color:#bf6600;" id="proj-count"></span>
    </label>
    <div id="proj-fold" class="proj-list project-hide"></div>
    <button type="button" class="add-proj-btn" onclick="addProjectInput()">+ Add Project</button>
    <label for="interests">Special Interests:</label>
    <input type="text" id="interests" placeholder="Eg: web dev, sports, ML"/>
    <label for="sports">Sports/Clubs & Highlights:</label>
    <input type="text" id="sports" placeholder="e.g., Football, State Debater, Robotics Club Head" />
    <label for="achievements">Achievements:</label>
    <input type="text" id="achievements" placeholder="Hackathon winner; Internship at TCS" />
    <label for="whatsapp">WhatsApp No(s) (comma separated)<span style="color:#d00;">*</span>:</label>
    <input type="text" id="whatsapp" required pattern="^(\d{10})(,\s*\d{10})*$" placeholder="9876543210,9123456780" />
    <label for="certificates">Upload Certificates (images/PDFs):</label>
    <input type="file" id="certificates" multiple accept="image/*,application/pdf"/>
    <div id="certificate-preview"></div>
    <label for="profile-pic">Upload Profile Picture:</label>
    <input type="file" id="profile-pic" accept="image/*" />
    <img id="profile-pic-preview" style="max-width:180px;display:none;" alt="Profile Picture Preview" />
    <button type="submit">Generate Portfolio</button>
  </form>
</div>
<div id="profile">
  <div class="header-top">
    <div class="profile-img-container">
      <img id="display-pic" class="profile-pic" src="" alt="Profile Picture" />
    </div>
    <div class="header-info">
      <div class="resume-title" id="display-name"></div>
      <div class="resume-sub">
        <span id="display-rollno"></span>
        <span>•</span> <span id="display-graduation"></span>
        <span>•</span> <span id="display-email"></span>
      </div>
      <div class="resume-quote" id="display-quote"></div>
    </div>
  </div>
  <hr>
  <div class="section">
    <div class="section-title"><i>💻</i>Programming Languages</div>
    <div class="badges" id="display-languages"></div>
    <div class="section-band"></div>
  </div>
  <div class="section">
    <div class="section-title"><i>🧰</i>Technical Areas</div>
    <div class="badges" id="display-tech"></div>
    <div class="section-band"></div>
  </div>
  <div class="section">
    <div class="section-title"><i>🧑‍💻</i>Core Skills & Proficiency</div>
    <div id="profile-skills"></div>
    <div class="section-band"></div>
  </div>
  <div class="section">
    <div class="section-title"><i>🛠️</i>Projects <span style="font-weight:300;font-size:17px;color:#ff7f00;" id="profile-proj-count"></span></div>
    <div id="profile-projects" class="project-list project-hide"></div>
    <div class="section-band"></div>
  </div>
  <div style="text-align:right;margin:0 0 13px 0;">
    <span class="project-toggle" style="font-size:1em;cursor:pointer;" onclick="toggleProfileProjects()"><i id="profile-proj-arrow">▼</i> Show/Hide All Project Info</span>
  </div>
  <div class="section" id="about-section" style="display:none;">
    <div class="section-title"><i>🎯</i>About & Hobbies</div>
    <div class="profile-row" id="hobby-row">
      <span class="label">Hobbies:</span><span id="display-hobbies"></span>
    </div>
  </div>
  <div class="section" id="interest-section" style="display:none;">
    <div class="section-title"><i>📚</i>Special Interests</div>
    <div class="tags" id="display-interests"></div>
  </div>
  <div class="section">
    <div class="section-title"><i>📞</i>Contact</div>
    <div class="badges" id="display-whatsapp"></div>
  </div>
  <div class="section sports-high" id="sports-section" style="display:none;">
    <div class="section-title"><i>⚡</i>Sports & Highlights</div>
    <div class="badges" id="display-sports"></div>
  </div>
  <div class="section" id="achieve-section" style="display:none;">
    <div class="section-title"><i>🏆</i>Achievements & Certificates</div>
    <div class="tags" id="display-achievements"></div>
    <div id="achievement-certificates" class="achievement-certificates"></div>
  </div>
  <div class="profile-actions">
    <button class="action-edit" id="edit-btn">Edit Details</button>
    <button class="action-delete" id="delete-btn">Delete Profile</button>
  </div>
  <div class="download-section">
    <button id="download-pdf" class="resume-download">Download PDF</button>
  </div>
</div>
<script>
const storageKey = 'studentPortfolio-2025';

function setTheme(cls) { 
  document.body.className = cls; 
  localStorage.setItem('theme', cls); 
}

document.addEventListener('DOMContentLoaded', () => {
  setTheme(localStorage.getItem('theme') || 'theme-day');

  const saved = localStorage.getItem(storageKey);
  if (saved) {
    showProfile(JSON.parse(saved));
  } else {
    showForm();
  }
  setupSkills();
  setupProjects();

});
  document.getElementById('profile-form').onsubmit = handleFormSubmit;
  document.getElementById('edit-btn').onclick = handleEdit;
  document.getElementById('delete-btn').onclick = handleDelete;
  document.getElementById('download-pdf').addEventListener('click', handleDownload);
});

let projFolded = true;

function toggleProjects() {
  projFolded = !projFolded;
  const foldEl = document.getElementById('proj-fold');
  foldEl.classList.toggle('project-hide', projFolded);
  document.getElementById('proj-arrow').textContent = projFolded ? "▼" : "▲";
}

function setupProjects() {
  projFolded = true;
  document.getElementById('proj-arrow').textContent = "▼";
  const foldEl = document.getElementById('proj-fold');
  foldEl.innerHTML = '';
  addProjectInput();
  if(projFolded) foldEl.classList.add('project-hide');
}

const projectsData = [];

function addProjectInput(title='', desc='', stack='', link='') {
  const list = document.getElementById('proj-fold');
  const index = projectsData.length;
  const el = document.createElement('div');
  el.className = "proj-item";
  el.setAttribute('data-index', index);
  el.innerHTML = `
    <button class="delproj-btn" type="button" onclick="delProjectInput(this)">Delete</button>
    <label>Project Title</label>
    <input type="text" class="proj-field-title" placeholder="e.g., Attendance Manager" value="${title}"/>
    <label>Description</label>
    <input type="text" class="proj-field-desc" placeholder="One line about project" value="${desc}"/>
    <label>Stack/Tags</label>
    <input type="text" class="proj-field-stack" placeholder="e.g., React, Node.js, Mongo" value="${stack}"/>
    <label>Link</label>
    <input type="text" class="proj-field-link" placeholder="GitHub or demo" value="${link}"/>
  `;
  list.appendChild(el);
  projectsData.push({el, title, desc, stack, link});
  updateProjectCount();
}

function delProjectInput(btn) {
  const el = btn.closest('.proj-item');
  el.remove();
  updateProjectCount();
}

function updateProjectCount() {
  const count = document.querySelectorAll('#proj-fold .proj-item').length;
  document.getElementById('proj-count').textContent = count ? `(${count})` : '';
}

let skillsList = [
  {label:"Teamwork", val:60},
  {label:"Communication", val:75},
  {label:"Problem Solving", val:70},
  {label:"Coding (General)", val:80},
  {label:"Creativity", val:75},
];

function setupSkills() { renderSkills(); }

function renderSkills() {
  const skillsDiv = document.getElementById('skills-area');
  skillsDiv.innerHTML = '';
  skillsList.forEach((skill, index) => {
    skillsDiv.appendChild(createSkillRow(skill, index));
  });
}

function createSkillRow(skill, index) {
  const row = document.createElement('div');
  row.className = "skill-row";

  const labelInput = document.createElement('input');
  labelInput.type = 'text';
  labelInput.value = skill.label;
  labelInput.className = 'skill-label';
  labelInput.style = "font-size:0.97em; font-weight:700; color:#278052; min-width:72px; max-width:170px; background:#ecfff8; border:none; margin-right:9px;";
  labelInput.onchange = () => { skillsList[index].label = labelInput.value; };

  const slider = document.createElement('input');
  slider.type = 'range';
  slider.min = 0;
  slider.max = 100;
  slider.value = skill.val;
  slider.className = 'edit-skill';

  const numInput = document.createElement('input');
  numInput.type = 'number';
  numInput.min = 0;
  numInput.max = 100;
  numInput.value = skill.val;
  numInput.style = 'width:35px; margin-right:6px; font-size:0.98em; padding:2px;';

  slider.oninput = () => {
    skillsList[index].val = parseInt(slider.value, 10);
    numInput.value = slider.value;
  };

  numInput.oninput = () => {
    slider.value = numInput.value;
    skillsList[index].val = parseInt(numInput.value, 10);
  };
  const delButton = document.createElement('button');
  delButton.type = 'button';
  delButton.textContent = 'Delete';
  delButton.style.marginLeft = '8px';
  delButton.onclick = () => {
    skillsList.splice(index, 1);
    renderSkills();
  };

  row.appendChild(labelInput);
  row.appendChild(slider);
  row.appendChild(numInput);
  row.appendChild(delButton);

  return row;
}
function addSkillInput() {
  skillsList.push({label: 'Skill', val: 60});
  renderSkills();
}
function autoSummary(name, branch = "CSE", gradYear = "2027") {
  return `${name} is a third-year ${branch} student graduating in ${gradYear}, passionate about technology, teamwork, and continuous learning.`;
}
function showForm() {
  document.getElementById('profile').classList.remove('active');
  document.getElementById('form-container').classList.add('active');
  setupSkills();
  setupProjects();
}
  function fillFormFields(data) {
  document.getElementById("first-name").value = data.firstName || "";
  document.getElementById("last-name").value = data.lastName || "";
  document.getElementById("rollno").value = data.rollno || "";
  document.getElementById("email").value = data.email || "";
  document.getElementById("summary").value = data.summary || "";
  document.getElementById("hobbies").value = data.hobbies || "";
  document.getElementById("interests").value = data.interests || "";
  document.getElementById("whatsapp").value = data.whatsapp || "";
  document.getElementById("achievements").value = data.achievements || "";
  document.getElementById("sports").value = data.sports || "";
  if (data.pic) {
    document.getElementById('profile-pic-preview').src = data.pic;
    document.getElementById('profile-pic-preview').style.display = 'block';
  } else {
    document.getElementById('profile-pic-preview').style.display = 'none';
  }
  const certDiv = document.getElementById('certificate-preview');
  certDiv.innerHTML = '';
  if (data.certificateFiles && data.certificateFiles.length) {
    data.certificateFiles.forEach(file => {
      if (file.type.startsWith('image')) {
        certDiv.innerHTML += `<img src="${file.data}" style="max-width:96px; margin:5px; border-radius:8px;" alt="Certificate Image">`;
      } else if (file.type === 'application/pdf') {
        certDiv.innerHTML += `<a href="${file.data}" target="_blank" style="display:block; margin:7px 0;">PDF Certificate: ${file.name}</a>`;
      }
    });
  }
}

function showProfile(data) {
  document.getElementById('form-container').classList.remove('active');
  const profileDiv = document.getElementById('profile');
  profileDiv.classList.add('active');
  document.getElementById('display-name').textContent = `${data.firstName} ${data.lastName}`;
  document.getElementById('display-rollno').textContent = "0902CS231" + ("000"+data.rollno).slice(-3);
  document.getElementById('display-graduation').textContent = "CSE • 2027";
  document.getElementById('display-email').textContent = data.email ? data.email : "";
  if(data.email) document.getElementById('display-email').style.display = 'inline';
  else document.getElementById('display-email').style.display = 'none';
  document.getElementById('display-quote').textContent = (data.summary && data.summary.trim())
    ? data.summary
    : autoSummary(`${data.firstName} ${data.lastName}`,"CSE","2027");
  if(data.hobbies && data.hobbies.trim()) {
    document.getElementById('about-section').style.display = 'block';
    document.getElementById('display-hobbies').textContent = data.hobbies;
  } else {
    document.getElementById('hobby-row').style.display = 'none';
    document.getElementById('about-section').style.display = 'none';
  }
  displayBadges(document.getElementById('display-languages'), data.languages || []);
  displayBadges(document.getElementById('display-tech'), data.tech || []);
  renderSkillBars(data.skills || skillsList);
  showProjectsProfile(data.projects);
  if(data.interests && data.interests.trim()) {
    document.getElementById('interest-section').style.display = 'block';
    createTags(document.getElementById('display-interests'), data.interests.split(',').map(s => s.trim()).filter(Boolean));
  } else {
    document.getElementById('interest-section').style.display = 'none';
    document.getElementById('display-interests').innerHTML = '';
  }
  displayBadges(document.getElementById('display-whatsapp'), (data.whatsapp || "").split(',').map(s => s.trim()).filter(Boolean));
  if(data.sports && data.sports.trim()) {
    document.getElementById('sports-section').style.display = 'block';
    displayBadges(document.getElementById('display-sports'), data.sports.split(',').map(s => s.trim()).filter(Boolean));
  } else {
    document.getElementById('sports-section').style.display = 'none';
    document.getElementById('display-sports').innerHTML = '';
  }
  if(data.achievements && data.achievements.trim()) {
    document.getElementById('achieve-section').style.display = 'block';
    createTags(document.getElementById('display-achievements'), data.achievements.split(',').map(s => s.trim()).filter(Boolean), 'achievement');
  } else {
    document.getElementById('achieve-section').style.display = 'none';
    document.getElementById('display-achievements').innerHTML = '';
    document.getElementById('achievement-certificates').innerHTML = '';
  }
  if(data.pic) {
    document.getElementById('display-pic').src = data.pic;
    document.getElementById('display-pic').style.display = 'block';
  } else {
    document.getElementById('display-pic').src = '';
    document.getElementById('display-pic').style.display = 'block';
  }
  document.getElementById('display-pic').onclick = function() {
    this.classList.toggle('pop');
    setTimeout(() => this.classList.remove('pop'), 1300);
  };
  renderAchievementCertificates(data);
  document.getElementById('profile-projects').classList.add('project-hide');
  document.getElementById('profile-proj-arrow').textContent = "▼";
}

}
function createTags(container, items, type) {
  container.innerHTML = '';
  items.forEach((item, idx) => {
    if (item) {
      const tag = document.createElement('div');
      tag.className = 'tag';
      tag.textContent = item;
      if (type === "achievement") tag.onclick = () => showCertDropdown(idx);
      container.appendChild(tag);
    }
  });
}

function displayBadges(container, items) {
  container.innerHTML = '';
  items.forEach((item) => {
    if (item) {
      const badge = document.createElement('div');
      badge.className = 'badge';
      badge.textContent = item;
      container.appendChild(badge);
    }
  });
}

function renderSkillBars(skills) {
  const skillsDiv = document.getElementById('profile-skills');
  skillsDiv.innerHTML = '';
  (skills || skillsList).forEach(s => {
    const row = document.createElement('div');
    row.className = "skill-row";
    const lab = document.createElement('span');
    lab.className = "skill-label";
    lab.textContent = s.label;
    const bg = document.createElement('div');
    bg.className = 'skill-bar-bg';
    const fill = document.createElement('div');
    fill.className = 'skill-bar-fill';
    fill.style.width = (s.val || 0) + "%";
    bg.appendChild(fill);
    const num = document.createElement('span');
    num.className = 'skill-bar-val';
    num.textContent = (s.val || 0) + "%";
    row.appendChild(lab);
    row.appendChild(bg);
    row.appendChild(num);
    skillsDiv.appendChild(row);
  });
}

function getProjectsFromForm() {
  return Array.from(document.querySelectorAll('#proj-fold .proj-item')).map((el) => ({
    title: el.querySelector('.proj-field-title').value.trim(),
    desc: el.querySelector('.proj-field-desc').value.trim(),
    stack: el.querySelector('.proj-field-stack').value.trim(),
    link: el.querySelector('.proj-field-link').value.trim()
  })).filter(p => p.title);
}

function showProjectsProfile(projects) {
  const projectsDiv = document.getElementById('profile-projects');
  projectsDiv.innerHTML = '';
  (projects || []).forEach(p => {
    if (p.title) {
      const card = document.createElement('div');
      card.className = "project-card";
      const t = document.createElement('div');
      t.className = "project-title";
      t.textContent = p.title;
      const d = document.createElement('div');
      d.textContent = p.desc || "";
      d.style.marginBottom = "10px";
      const s = document.createElement('div');
      s.className = "project-stack";
      s.textContent = p.stack ? "Stack: " + p.stack : "";
      card.appendChild(t);
      if (p.desc) card.appendChild(d);
      if (p.stack) card.appendChild(s);
      if (p.link && p.link.trim()) card.innerHTML += `<a href="${p.link}" class="project-link" target="_blank">View Project</a>`;
      projectsDiv.appendChild(card);
    }
  });
  document.getElementById('profile-proj-count').textContent = "(" + ((projects || []).length || 0) + ")";
}
function toggleProfileProjects() {
  const el = document.getElementById('profile-projects');
  const arr = document.getElementById('profile-proj-arrow');
  const visible = !el.classList.contains('project-hide');
  el.classList.toggle('project-hide', visible);
  arr.textContent = visible ? "▼" : "▲";
}

function showCertDropdown(achievementIdx) {
  const certDiv = document.getElementById('achievement-certificates');
  certDiv.innerHTML = '';
  const data = JSON.parse(localStorage.getItem(storageKey));
  const certs = (data.certificateFiles || [])[achievementIdx] || [];
  if (!certs.length) {
    certDiv.innerHTML = '<div class="cert-dropdown">No certificate uploaded for this achievement.</div>';
    return;
  }
  let html = '<div class="cert-dropdown">';
  certs.forEach((file, i) => {
    if (file.type.startsWith("image/"))
      html += `<img src="${file.data}" style="max-width:100%;margin-bottom:9px;border-radius:8px;">`;
    else if (file.type === "application/pdf")
      html += `<a class="cert-link" href="${file.data}" target="_blank">Certificate PDF #${i + 1}</a>`;
  });
  html += '</div>';
  certDiv.innerHTML = html;
}

function renderAchievementCertificates() {
  document.getElementById('achievement-certificates').innerHTML = '';
}
  document.getElementById('profile-form').onsubmit = async function(e) {
  e.preventDefault();
  
  const firstName = document.getElementById('first-name').value.trim();
  const lastName = document.getElementById('last-name').value.trim();
  const rollno = document.getElementById('rollno').value.trim();
  const email = document.getElementById('email').value.trim();
  const summary = document.getElementById('summary').value.trim();
  const hobbies = document.getElementById('hobbies').value.trim();
  const interests = document.getElementById('interests').value.trim();
  const whatsapp = document.getElementById('whatsapp').value.trim();
  const achievements = document.getElementById('achievements').value.trim();
  const sports = document.getElementById('sports').value.trim();

  const picInput = document.getElementById('profile-pic');
  const certInput = document.getElementById('certificates');
  const languages = Array.from(document.querySelectorAll('#languagesbox input[type="checkbox"]:checked')).map(e => e.value);
  const tech = Array.from(document.querySelectorAll('#techbox input[type="checkbox"]:checked')).map(e => e.value);
  const skills = skillsList.map(s => ({label: s.label, val: s.val}));
  const projects = getProjectsFromForm();

  if (!firstName || !lastName || !rollno || !whatsapp) {
    alert('Please fill all required fields marked *.');
    return;
  }
  
  if (!/^\d+$/.test(rollno) || +rollno < 0 || +rollno > 999) {
    alert('Please enter a valid integer between 000 and 999 for your roll number.');
    return;
  }

  const whatsappRegex = /^(\d{10})(,\s*\d{10})*$/;
  if (!whatsappRegex.test(whatsapp)) {
    alert('WhatsApp numbers must be 10 digits, separated by commas.');
    return;
  }

  let achievementArr = achievements ? achievements.split(',').map(s => s.trim()).filter(Boolean) : [];
  let certificateFiles = [];

  if (certInput.files.length && achievementArr.length) {
    for (let i = 0; i < achievementArr.length; i++) {
      certificateFiles[i] = [];
    }
    
    for (let i = 0; i < certInput.files.length; i++) {
      const fileObj = await fileToBase64(certInput.files[i]);
      certificateFiles[i % achievementArr.length].push(fileObj);
    }
  }

  const profileData = {
    firstName,
    lastName,
    rollno,
    email,
    summary,
    hobbies,
    interests,
    whatsapp,
    achievements,
    sports,
    certificateFiles,
    pic: null,
    languages,
    tech,
    skills,
    projects
  };

  if (picInput.files.length) {
    readBase64(picInput.files[0], pic => {
      profileData.pic = pic;
      localStorage.setItem(storageKey, JSON.stringify(profileData));
      showProfile(profileData);
    });
  } else {
    localStorage.setItem(storageKey, JSON.stringify(profileData));
    showProfile(profileData);
  }
};

document.getElementById("edit-btn").onclick = function() {
  if (confirm("Edit your details?")) {
    const savedProfile = localStorage.getItem(storageKey);
    if (savedProfile) {
      fillFormFields(JSON.parse(savedProfile));
    }
    showForm();
  }
};

document.getElementById("delete-btn").onclick = function() {
  if (confirm("Delete profile permanently?")) {
    localStorage.removeItem(storageKey);
    showForm();
  }
};

document.getElementById("download-pdf").addEventListener("click", function() {
  const element = document.getElementById("profile");
  const profileImgContainer = element.querySelector(".profile-img-container");
  const originalWidth = profileImgContainer.style.width;
  const originalHeight = profileImgContainer.style.height;
  const editDeleteSection = element.querySelector(".profile-actions");
  const downloadSection = element.querySelector(".download-section");

  if (editDeleteSection) editDeleteSection.classList.add("pdf-hide");
  if (downloadSection) downloadSection.classList.add("pdf-hide");

  profileImgContainer.style.width = "240px";
  profileImgContainer.style.height = "240px";
  profileImgContainer.style.borderRadius = "50%";
  if (profileImgContainer.querySelector("img")) {
    profileImgContainer.querySelector("img").style.borderRadius = "50%";
  }
  profileImgContainer.style.overflow = "hidden";

  setTimeout(() => {
    html2pdf()
      .set({
        margin: 1,
        filename: "portfolio.pdf",
        image: { type: "jpeg", quality: 0.98 },
        html2canvas: { scale: 3 },
        jsPDF: { unit: "in", format: "a4", orientation: "portrait" }
      })
      .from(element)
      .save()
      .then(() => {
        profileImgContainer.style.width = originalWidth;
        profileImgContainer.style.height = originalHeight;
        if (editDeleteSection) editDeleteSection.classList.remove("pdf-hide");
        if (downloadSection) downloadSection.classList.remove("pdf-hide");
      });
  }, 150);
});
</script>
</body>
</html>
